# update_fastlane

default_platform(:ios)

platform :ios do

  # desc "Ensure valid individual code signing assets for project, using person-based schema"
  # lane :solo_development do
  #   cert
  #   sigh
  # end

  # lane :team_development do
  #   register_devices(
  #     devices: {
  #       "brian excess" => "00008020-001C491C0268002E",
  #       "Pro 120" => "f25bd75b4b3d643c749902dce888ae83c1f1f4ad"
  #     }
  #   )
  #   match(type: "development")
  # end

  desc "Ensure app is registered with App Store Connect"
  lane :sync_app_info do
    produce(
      username: "bschick1@mac.com",
      app_identifier: "com.razeware.ChewChewTrain",
      app_name: "Chew Chew Train",
      team_name: "Brian Schick",
      itc_team_name: "Brian Schick",
      language: "English",
      app_version: "1.0"
    )
  end

  lane :sync_device_info do
    register_devices(
      devices: {
        "brian excess" => "00008020-001C491C0268002E",
        "Pro 120" => "f25bd75b4b3d643c749902dce888ae83c1f1f4ad"
      }
    )
  end

  lane :sync_all_development do
    sync_app_info
    sync_device_info
    match(type: "development")
  end

  lane :sync_all_adhoc do
    sync_app_info
    sync_device_info
    match(type: "adhoc")
  end

  lane :sync_all_appstore do
    sync_app_info
    sync_device_info
    match(type: "appstore")
  end

  lane :export_adhoc do
    sync_all_adhoc
    increment_build_number
    gym(
      output_directory: "Export_AdHoc",
      export_method: "ad-hoc"
    )
  end



  # I need to add external testers somewhere in here...

  lane :export_for_itunes_connect do
    sync_all_appstore
    increment_build_number
    gym(
      output_directory: "Export_iTunesConnect",
      export_method: "app-store"
    )
  end

  lane :distribute_to_itunes_connect do
    export_for_itunes_connect
    pilot(
      team_name: "Brian Schick",
      ipa: "./Export_iTunesConnect/ChewChewTrain.ipa",
      changelog: "Build {lane_context[SharedValues::BUILD_NUMBER]}"
    )
  end 

  lane :distribute_to_installr do
    export_adhoc
    installr(
      api_token: "",
      notes: "Build {lane_context[SharedValues::BUILD_NUMBER]}"
    )
  end

  lane :distribute_to_tryouts do
    export_adhoc
    tryouts(
      api_token: "",
      app_id: "",
      notes: "Build {lane_context[SharedValues::BUILD_NUMBER]}"
    )
  end
  
end
